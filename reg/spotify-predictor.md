# Using Spotify track metadata to predict song popularity
By: Joyce Tagal
## Abstract

Can a machine learning model predict the popularity of a song better than a record label executive? Sony Music wants to build a predictor to identify the possible popularity of a song, so that they can identify hit songs ahead of time and market them accordingly. This task is becoming more difficult given that music tastes have become more global, thanks to the internet and streaming platforms like Spotify and Pandora. Now, label executives have to identify possible hits from a wide variety of genres and artists. Enter machine learning! Perhaps Sony can build a predictor that
will help identify the popularity of a recorded track based on several traits. With a large amount of data available on platforms such as Spotify, data scientists can build predictors relatively easily from open source data.

Sony would like to first build a predictor for the United States market and, if the predictor has a high degree of accuracy, to build the same for other countries.

## Design

Spotify has made billions of rows of metadata available on all the songs in its catalog, available on its Web API. The features included in metadata range from musicality features such as `tempo`, `mode` and `time-signature` to more descriptive measures such as `liveness` and `valence`, that measures the happiness level of the track. 

The company also measures our target variable, known as `popularity`, a measure that is generated by a Spotify algorithm that includes number of listens, the artist's popularity and the album popularity. We will use the other features available in the API below to see if we can predict popularity based on the track's metadata.

Per the Spotify Tracks API documentation, API contains the following features for each track: 
- danceability (0-1) - how suitable a track is for dancing
- energy (0-1) - measure of intensity and activity
- key (0-11) - using standard Pitch Class notation where 0=C
- loudness (-60-0)
- mode (0 or 1) - major (1) or minor (0) key
- speechiness (0-1) - the presence of spoken words on a track
- accousticness (0-1) - whether the track is accoustic
- instrumentalness - whether a track has no vocals
- liveness (0-1) - detects the presence of an audience in the recording
- valence (0-1) - the musical "positiveness" of a track, i.e. happiness 
- tempo (float) - estimated tempo in beats per minute
- time-signature - estimated time signature of a track
- genre - the type of genre for the track's artist

## Data

During my project, I ran into some target distribution issues with the first dataset I had scraped from the Top 200 weekly charts, because the `popularity` distribution was skewed to the high side. I then supplemented my initial dataset with the two other datasets as described below to increase the normality of my target distribution.

- 1,277 rows were scraped from the Spotify Top 200 weekly charts for the year between 09-01-2021 and 09-01-2020
- 4,099 rows were scraped from Spotify's API using random search terms
- 10,000 rows were randomly sampled from a dataset of 228,159 rows downloaded from Kaggle

## Algorithms

- Built a linear regression model in python to evaluate the prediction model
- Used evaluation metrics including R^2 to test different models
- Tested a target transformation 
- Conducted feature engineering, including creating dummy variables for the `genre` variable
- Improved my training dataset by achieving a better target distribution
- Used `sklearn` to train and evaluate my model by splitting datasets

## Tools
- BeautifulSoup and Selenium for scraping spotifycharts.com
- pandas to summarize and clean the data
- seaborn for visualizing the data
- statsmodel for doing some baseline stats score with R^2
- sklearn for training the model and model evaluation

## Communication

Ultimately I was able to achieve an R^2 of 70% once I had conducted some feature engineering and added more training data. I developed slides to communicate my model development process and predictive outcomes, and have developed notebooks to explain the process.